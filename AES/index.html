<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>AES Algorithm Visualization</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .col {
      margin: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      overflow-y: auto !important;
      overflow-x: hidden;
      color: #1f2937;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
      color: #1f2937;
      min-height: 100vh;
      overflow-y: auto !important;
      overflow-x: hidden;
    }

    table {
      border-collapse: collapse;
    }

    table, th, td {
      border: 2px solid rgb(200, 200, 200);
    }

    td {
      padding: 10px 10px;
      font-size: 22px;
      color: rgb(86, 242, 27);
    }

    

    input {
      background-color: rgba(0,0,0,0);
      color :rgb(240, 240, 240);
      padding: 5px 10px;
      border: 1px solid white;
      text-align: center;
      color: rgb(86, 242, 27);
      font-family: monospace;
      font-weight: bold;
    }

    #input-panel {
      height: 100vh;
      /* background-color: red; */
      padding: 10px;
      border-right: 1px solid white;
      text-align: center;
    }

    #input-panel table {
      margin-left:auto;
      margin-right:auto;
    }

    #results-container {
      padding: 10px;
      padding-left: 30px;
      height: 100vh;
      overflow: auto;
    }

    #results-container{
      display: inline-block;
      text-align: center;
    }

    #results-container table {
      margin-left:auto;
      margin-right:auto;
      /* display: inline-table; */
      /* float: right; */
    }

    #results-container td {
      padding: 5px 5px;
      font-size: 15px;
      color: rgb(86, 242, 27);
    }

    .animate-fade {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }
    .info-box {
      background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%);
    }
    .canvas-container {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-radius: 12px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .title-gradient {
      background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    input, select {
      background: white !important;
      color: #1f2937 !important;
      border: 1px solid #d1d5db !important;
    }
    input::placeholder {
      color: #9ca3af !important;
    }
    select {
      min-width: 150px;
    }
    .key-select-label {
      color: #4b5563;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
      display: block;
    }
    .explanation-text {
        font-size: 1.1rem !important;
        line-height: 1.6 !important;
    }
    
    .matrix-cell {
        font-size: 1.1rem !important;
        padding: 0.75rem !important;
    }
    
    .s-box-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
    }
    
    .s-box-table th,
    .s-box-table td {
        padding: 0.5rem;
        text-align: center;
        border: 1px solid #e5e7eb;
        font-family: monospace;
        font-size: 0.9rem;
    }
    
    .s-box-table th {
        background-color: #f3f4f6;
        font-weight: bold;
    }
    
    .s-box-table td:hover {
        background-color: #ddd6fe;
        transition: background-color 0.2s;
    }
    
    .grid {
        max-width: none !important;
    }
    
    .card {
        padding: 2rem !important;
    }
    
    .info-box {
        padding: 1.5rem !important;
    }
    
    h1 {
        font-size: 2.5rem !important;
    }
    
    h2 {
        font-size: 1.8rem !important;
    }
    
    h3 {
        font-size: 1.5rem !important;
    }
    
    .canvas-container {
        height: auto !important;
        overflow: visible !important;
    }
    
    .gap-8 {
        gap: 2rem !important;
    }

    .flow-diagram {
        max-width: 800px;
        margin: 2rem auto;
        text-align: center;
    }

    .flow-step {
        padding: 1rem 2rem;
        margin: 0.5rem auto;
        border-radius: 25px;
        width: 300px;
        font-weight: 500;
        position: relative;
        transition: all 0.3s ease;
    }

    .flow-step::after {
        content: "↓";
        position: absolute;
        bottom: -25px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 20px;
        color: #6b7280;
    }

    .flow-step:last-child::after {
        display: none;
    }

    .flow-step.active {
        transform: scale(1.05);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }

    .flow-arrow {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        font-size: 24px;
        color: #6366f1;
        opacity: 0;
        transition: all 0.3s ease;
    }

    .flow-arrow.active {
        opacity: 1;
        animation: moveArrow 1s infinite;
    }

    @keyframes moveArrow {
        0%, 100% { transform: translateX(-50%) translateY(0); }
        50% { transform: translateX(-50%) translateY(10px); }
    }

    .initial-round {
        background-color: #D1FAE5;
        border: 2px solid #059669;
        color: #065F46;
    }

    .sub-bytes {
        background-color: #DBEAFE;
        border: 2px solid #3B82F6;
        color: #1E40AF;
    }

    .shift-rows {
        background-color: #FCE7F3;
        border: 2px solid #EC4899;
        color: #9D174D;
    }

    .mix-columns {
        background-color: #FEF3C7;
        border: 2px solid #F59E0B;
        color: #92400E;
    }

    .add-round-key {
        background-color: #D1FAE5;
        border: 2px solid #059669;
        color: #065F46;
    }

    .round-loop {
        border: 2px dashed #6B7280;
        border-radius: 15px;
        padding: 2rem;
        margin: 2rem 0;
        position: relative;
    }

    .round-label {
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        padding: 0 1rem;
        color: #6B7280;
    }

    .final-round {
        margin-top: 2rem;
        padding: 2rem;
        border: 2px solid #E5E7EB;
        border-radius: 15px;
    }

    .rounds-container {
        max-height: 400px;  /* Fixed height for scroll area */
        overflow-y: auto;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 1rem;
        margin: 1rem 0;
        background: #f9fafb;
    }

    /* Custom scrollbar styling */
    .rounds-container::-webkit-scrollbar {
        width: 8px;
    }

    .rounds-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }

    .rounds-container::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }

    .rounds-container::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    /* Ensure smooth scrolling */
    .rounds-container {
        scroll-behavior: smooth;
    }

    /* Style for round entries */
    .round-entry {
        background: white;
        margin-bottom: 1rem;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .quiz-button {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #01E9F8;
        color: #1F252E;
        padding: 12px 24px;
        border-radius: 25px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(1, 233, 248, 0.3);
        transition: all 0.3s ease;
        z-index: 1000;
    }

    /* Leaderboard Modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(5px);
        background-color: rgba(0, 0, 0, 0.3);
        z-index: 1000;
    }


    .modal-content {
        background: rgba(17, 25, 40, 0.83);
        backdrop-filter: blur(12px);
        border-radius: 12px;
        padding: 20px;
        width: 80%;
        max-width: 600px;
        margin: 5% auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .modal-header h2 {
        color: #ffffff;
        margin: 0;
        font-size: 1.5rem;
        font-weight: 600;
    }

    .modal-header .close {
        color: #ffffff;
        font-size: 1.8rem;
        cursor: pointer;
        background: none;
        border: none;
        padding: 0 8px;
        transition: color 0.3s ease;
    }

    .modal-header .close:hover {
        color: #ff4444;
    }

    #leaderboardTable {
        width: 100%;
        border-collapse: collapse;
        color: white;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        overflow: hidden;
    }

    #leaderboardTable th {
        background: rgba(255, 255, 255, 0.1);
        padding: 12px;
        text-align: left;
        font-weight: 600;
        color: #00d2ff;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    #leaderboardTable td {
        padding: 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    #leaderboardTable tr:last-child td {
        border-bottom: none;
    }

    #leaderboardTable tbody tr {
        transition: background-color 0.3s ease;
    }

    #leaderboardTable tbody tr:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    /* Medal styles */
    .medal-1 td:first-child {
        color: gold;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    .medal-2 td:first-child {
        color: silver;
        text-shadow: 0 0 10px rgba(192, 192, 192, 0.5);
    }

    .medal-3 td:first-child {
        color: #cd7f32;
        text-shadow: 0 0 10px rgba(205, 127, 50, 0.5);
    }

    /* Loading spinner enhancement */
    .loading-spinner {
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-left: 3px solid #00d2ff;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Score column styling */
    #leaderboardTable td:last-child {
        color: #00d2ff;
        font-weight: 600;
    }

    /* Username column styling */
    #leaderboardTable td:nth-child(2) {
        font-weight: 500;
    }

    .header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: rgba(15, 25, 35, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        z-index: 1000;
        padding: 1rem 0;
        border-bottom: 1px solid rgba(1, 233, 248, 0.1);
        transition: all 0.3s ease;
    }

    .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 2rem;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
    }

    .logo-icon {
        font-size: 1.5rem;
        color: #01E9F8;
    }

    .logo-text {
        font-size: 1.2rem;
        font-weight: 700;
        display: none;
    }

    @media (min-width: 768px) {
        .logo-text {
            display: block;
        }
    }

    .nav-links {
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }

    .nav-link {
        color: #ffffff;
        text-decoration: none;
        font-weight: 500;
        font-size: 0.95rem;
        position: relative;
        padding: 0.5rem 0;
        transition: color 0.3s ease;
    }

    .nav-link:hover {
        color: #01E9F8;
    }

    .btn-outline {
        background: transparent;
        color: #01E9F8;
        border: 1px solid #01E9F8;
        padding: 0.6rem 1.2rem;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .btn-outline:hover {
        background: rgba(1, 233, 248, 0.1);
        transform: translateY(-2px);
        box-shadow: 0 0 15px rgba(1, 233, 248, 0.5);
    }

    .user-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .welcome-text {
        color: #01E9F8;
        font-size: 1.1rem;
        margin-right: 1rem;
    }

    .sign-in-btn {
        background-color: #01E9F8 !important;
        color: #000 !important;
        border: none !important;
        padding: 0.5rem 1rem !important;
        border-radius: 5px !important;
        cursor: pointer !important;
        font-weight: 500 !important;
        transition: all 0.3s ease !important;
        font-family: 'Inter', sans-serif !important;
    }

    .sign-in-btn:hover {
        background-color: #00b3d8 !important;
        transform: translateY(-2px) !important;
    }
  </style>
  <link rel="stylesheet" href="../css/quiz.css">
  <script src="../js/chatbot.js"></script>
  <script src="../js/quiz.js"></script>
  <script src="../js/leaderboard.js"></script>
</head>
<body>
  <!-- Navigation Bar -->
  <header class="header">
    <div class="header-container">
        <a href="../index.html" class="logo">
            <i class="fa-solid fa-shield-halved logo-icon"></i>
            <span class="logo-text" style="color: #ffffff;">Security Viz</span>
        </a>
        
        <nav class="nav-links">
            <a href="../index.html" class="nav-link">Home</a>
            <a href="../key-strength.html" class="nav-link">Key Strength</a>
            <a href="../algorithm-comparison.html" class="nav-link">Comparison</a>
            
        </nav>
        
        <div class="user-actions" id="userInfo">
            <!-- This will be populated by JavaScript -->
        </div>
    </div>
  </header>

  <!-- Quiz Button -->
  <div style="position: fixed; top: 80px; right: 20px; z-index: 999; display: flex; gap: 10px;">
    <button class="quiz-button" onclick="startQuiz('AES')" style="position: static;">Take Quiz</button>
  </div>

  <!-- Leaderboard Button -->
  <div style="position: fixed; top: 80px; left: 20px; z-index: 999; display: flex; gap: 10px;">
    <button 
        class="leaderboard-button" 
        onclick="showLeaderboard('AES')" 
        style="background: linear-gradient(135deg, #3a7bd5, #00d2ff); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 20px rgba(58, 123, 213, 0.4); transition: all 0.3s ease;">
        🏆 Leaderboard
    </button>
    
  </div>

  <div class="container mx-auto px-4 py-8 max-w-6xl" style="padding-top: 80px;">
    <h1 class="text-3xl font-bold text-center mb-8 title-gradient">AES Algorithm Visualization</h1>

    <!-- Input Section -->
    <div class="card rounded-lg mb-8 p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <h2 class="text-xl font-semibold mb-4">Input Message</h2>
          <input 
            type="text" 
            id="messageInput" 
            placeholder="Enter message to encrypt"
            class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
          >
        </div>
        <div>
          <h2 class="text-xl font-semibold mb-4">Key</h2>
          <div class="flex gap-2">
            <div class="flex flex-col">
              <label for="keySize" class="key-select-label">Key Size:</label>
              <select 
                id="keySize" 
                class="px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
                aria-label="Select key size"
              >
                <option value="128">128-bit (AES-128)</option>
                <option value="192">192-bit (AES-192)</option>
                <option value="256">256-bit (AES-256)</option>
              </select>
            </div>
            <input 
              type="text" 
              id="keyInput" 
              placeholder="Enter encryption key"
              class="flex-1 px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500"
            >
            <button 
              onclick="generateRandomKey()"
              class="bg-purple-500 text-white px-4 py-2 rounded-md hover:bg-purple-600 transition-colors"
              title="Generate Random Key"
            >
              <i class="fas fa-random"></i>
            </button>
          </div>
        </div>
      </div>
      <div class="mt-6 flex justify-center gap-4">
        <button 
          onclick="startEncryption()"
          class="bg-purple-500 text-white px-6 py-2 rounded-md hover:bg-purple-600 transition-colors"
        >
          Encrypt
        </button>
        <button 
          onclick="startDecryption()"
          class="bg-green-500 text-white px-6 py-2 rounded-md hover:bg-green-600 transition-colors"
        >
          Decrypt
        </button>
        <button 
          onclick="toggleExample()"
          class="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors"
        >
          Show Example
        </button>
      </div>
    </div>

    <!-- Step Navigation -->
    <div id="stepNavigation" class="hidden mb-8">
      <div class="flex justify-center items-center gap-4">
        <button 
          onclick="previousStep()"
          class="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition-colors"
        >
          Previous Step
        </button>
        <span id="currentStep" class="text-xl font-semibold">Step 1</span>
        <button 
          onclick="nextStep()"
          class="bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600 transition-colors"
        >
          Next Step
        </button>
      </div>
    </div>

    <!-- Visualization Grid -->
    <div class="grid md:grid-cols-2 gap-8">
      <!-- Step 1: Initial Round -->
      <div class="card rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-2">1. Initial Round</h3>
        <div class="info-box p-4 rounded-md mb-4">
          <p class="font-medium">AddRoundKey Operation:</p>
          <div class="mt-2 space-y-2">
            <div class="bg-white p-3 rounded">
              <p class="text-sm">The input is arranged in a 4x4 matrix of bytes:</p>
              <div id="initialRound" class="space-y-4"></div>
              </div>
            </div>
          </div>
      </div>

      <!-- Step 2: Main Rounds -->
      <div class="card rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-2">2. Main Rounds (1-9)</h3>
        <div class="info-box p-4 rounded-md mb-4">
          <p class="font-medium mb-4">Four Transformations:</p>
          <button 
            onclick="scrollToShiftRowsExplanation()"
            class="bg-indigo-500 text-white px-4 py-2 rounded-md hover:bg-indigo-600 transition-colors mb-4"
          >
            View Transformation Details
          </button>
        <div class="rounds-container">
          <div id="mainRounds" class="space-y-4"></div>
          </div>
        </div>
      </div>

      <!-- Step 3: Final Round -->
      <div class="card rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-2">3. Final Round</h3>
        <div class="info-box p-4 rounded-md mb-4">
          <p class="font-medium">Final Transformations:</p>
          <div class="space-y-2 mt-2">
            <div class="bg-white p-2 rounded">
              <p class="text-sm">Similar to main rounds but without MixColumns:</p>
              <ol class="list-decimal list-inside text-xs mt-1 text-gray-600">
                <li>SubBytes</li>
                <li>ShiftRows</li>
                <li>AddRoundKey</li>
              </ol>
            </div>
          </div>
        </div>
        <div id="finalRound" class="space-y-4"></div>
      </div>

      <!-- Final Result -->
      <div class="card rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-2">4. Final Result</h3>
        <div class="info-box p-4 rounded-md mb-4">
          <p class="font-medium">Security Features:</p>
          <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
            <li>Strong confusion and diffusion</li>
            <li>Resistant to known attacks</li>
            <li>Mathematically proven security</li>
          </ul>
        </div>
        <div id="finalResult" class="space-y-4"></div>
      </div>
    </div>

    <!-- Add this HTML where you want to show the flow diagram -->
    <div class="flow-diagram">
        <!-- Initial AddRoundKey -->
        <div class="flow-step initial-round">
            AddRoundKey
        </div>
        <div class="flow-arrow">↓</div>

        <!-- Main Rounds -->
        <div class="round-loop">
            <div class="round-label">Round 1</div>
            
            <div class="flow-step sub-bytes">
                1 - SubBytes
            </div>
            <div class="flow-arrow">↓</div>
            
            <div class="flow-step shift-rows">
                2 - ShiftRows
            </div>
            <div class="flow-arrow">↓</div>
            
            <div class="flow-step mix-columns">
                3 - MixColumns
            </div>
            <div class="flow-arrow">↓</div>
            
            <div class="flow-step add-round-key">
                4 - AddRoundKey
            </div>
        </div>
        <div class="flow-arrow">↓</div>

        <!-- Final Round -->
        <div class="final-round">
            <div class="flow-step sub-bytes">
                SubBytes
            </div>
            <div class="flow-arrow">↓</div>
            
            <div class="flow-step shift-rows">
                ShiftRows
            </div>
            <div class="flow-arrow">↓</div>
            
            <div class="flow-step add-round-key">
                AddRoundKey
            </div>
        </div>
    </div>
  </div>

  <!-- Leaderboard Modal -->
  <div id="leaderboardModal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h2>Overall Rankings</h2>
              <span class="close" onclick="closeOverallLeaderboard()">&times;</span>
          </div>
          <div class="modal-body">
              <table id="leaderboardTable">
                  <thead>
                      <tr>
                          <th>Rank</th>
                          <th>Username</th>
                          <th>Average Score</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr>
                          <td colspan="4" style="text-align: center;">
                              <div class="loading-spinner"></div>
                              <p>Loading rankings...</p>
                          </td>
                      </tr>
                  </tbody>
              </table>
          </div>
      </div>
  </div>

  <!-- Quiz Modal -->
  <div class="quiz-overlay" id="quizOverlay"></div>
  <div class="quiz-modal" id="quizModal">
      <span class="close-quiz" onclick="closeQuiz()">&times;</span>
      <div id="quizContent"></div>
  </div>

  <div id="exampleContent" class="hidden bg-white p-6 rounded-lg shadow-lg mb-4">
    <h2 class="text-2xl font-bold mb-4">AES Transformation Examples</h2>

    <!-- Visualization Grid -->
    <div class="grid md:grid-cols-2 gap-8">
      <!-- Step 1: Initial Round -->
      <div class="card rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-2">1. Initial Round</h3>
        <div class="info-box p-4 rounded-md mb-4">
          <p class="font-medium">AddRoundKey Operation:</p>
          <div class="mt-2 space-y-2">
            <div class="bg-white p-3 rounded">
              <p class="text-sm">The input is arranged in a 4x4 matrix of bytes:</p>
              <div class="grid grid-cols-4 gap-1 mt-2 font-mono text-xs">
                <div class="bg-purple-50 p-1 text-center">b0</div>
                <div class="bg-purple-50 p-1 text-center">b4</div>
                <div class="bg-purple-50 p-1 text-center">b8</div>
                <div class="bg-purple-50 p-1 text-center">b12</div>
                <div class="bg-purple-50 p-1 text-center">b1</div>
                <div class="bg-purple-50 p-1 text-center">b5</div>
                <div class="bg-purple-50 p-1 text-center">b9</div>
                <div class="bg-purple-50 p-1 text-center">b13</div>
                <div class="bg-purple-50 p-1 text-center">b2</div>
                <div class="bg-purple-50 p-1 text-center">b6</div>
                <div class="bg-purple-50 p-1 text-center">b10</div>
                <div class="bg-purple-50 p-1 text-center">b14</div>
                <div class="bg-purple-50 p-1 text-center">b3</div>
                <div class="bg-purple-50 p-1 text-center">b7</div>
                <div class="bg-purple-50 p-1 text-center">b11</div>
                <div class="bg-purple-50 p-1 text-center">b15</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 2: Main Rounds -->
      <div class="card rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-2">2. Main Rounds (1-9)</h3>
        <div class="info-box p-4 rounded-md mb-4">
          <p class="font-medium mb-4">Four Transformations Explained:</p>
          
          <!-- 1. SubBytes -->
          <div class="bg-white p-6 rounded mb-4">
            <p class="font-medium text-lg mb-3">1. SubBytes Transformation:</p>
            <div class="grid grid-cols-1 gap-6 mt-4">
                <div>
                    <p class="text-gray-600 mb-4 explanation-text">Each byte in the state matrix is replaced using the S-box lookup table. This provides non-linearity to the cipher:</p>
                    <div class="bg-purple-50 p-4 rounded mb-4">
                        <p class="font-medium mb-2 explanation-text">How to use the S-box:</p>
                        <ol class="list-decimal list-inside space-y-2 explanation-text">
                            <li>Split byte into two parts (e.g., 53 → 5,3)</li>
                            <li>Use first digit for row (5), second for column (3)</li>
                            <li>Find the intersection in the table</li>
                        </ol>
                    </div>
                </div>
                <div>
                    <p class="font-medium mb-2 explanation-text">Complete S-box Lookup Table:</p>
                    <div class="overflow-x-auto">
                        <table class="s-box-table">
                            <tr>
                                <th>x/y</th>
                                <th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th>
                                <th>7</th><th>8</th><th>9</th><th>A</th><th>B</th><th>C</th><th>D</th>
                                <th>E</th><th>F</th>
                            </tr>
                            <tr>
                                <th>0</th>
                                <td>63</td><td>7C</td><td>77</td><td>7B</td><td>F2</td><td>6B</td><td>6F</td>
                                <td>C5</td><td>30</td><td>01</td><td>67</td><td>2B</td><td>FE</td><td>D7</td>
                                <td>AB</td><td>76</td>
                            </tr>
                            <tr>
                                <th>1</th>
                                <td>CA</td><td>82</td><td>C9</td><td>7D</td><td>FA</td><td>59</td><td>47</td>
                                <td>F0</td><td>AD</td><td>D4</td><td>A2</td><td>AF</td><td>9C</td><td>A4</td>
                                <td>72</td><td>C0</td>
                            </tr>
                            <tr>
                                <th>2</th>
                                <td>B7</td><td>FD</td><td>93</td><td>26</td><td>36</td><td>3F</td><td>F7</td>
                                <td>CC</td><td>34</td><td>A5</td><td>E5</td><td>F1</td><td>71</td><td>D8</td>
                                <td>31</td><td>15</td>
                            </tr>
                            <tr>
                                <th>3</th>
                                <td>04</td><td>C7</td><td>23</td><td>C3</td><td>18</td><td>96</td><td>05</td>
                                <td>9A</td><td>07</td><td>12</td><td>80</td><td>E2</td><td>EB</td><td>27</td>
                                <td>B2</td><td>75</td>
                            </tr>
                            <tr>
                                <th>4</th>
                                <td>09</td><td>83</td><td>2C</td><td>1A</td><td>1B</td><td>6E</td><td>5A</td>
                                <td>A0</td><td>52</td><td>3B</td><td>D6</td><td>B3</td><td>29</td><td>E3</td>
                                <td>2F</td><td>84</td>
                            </tr>
                            <tr>
                                <th>5</th>
                                <td>53</td><td>D1</td><td>00</td><td>ED</td><td>20</td><td>FC</td><td>B1</td>
                                <td>5B</td><td>6A</td><td>CB</td><td>BE</td><td>39</td><td>4A</td><td>4C</td>
                                <td>58</td><td>CF</td>
                            </tr>
                            <tr>
                                <th>6</th>
                                <td>D0</td><td>EF</td><td>AA</td><td>FB</td><td>43</td><td>4D</td><td>33</td>
                                <td>85</td><td>45</td><td>F9</td><td>02</td><td>7F</td><td>50</td><td>3C</td>
                                <td>9F</td><td>A8</td>
                            </tr>
                            <tr>
                                <th>7</th>
                                <td>51</td><td>A3</td><td>40</td><td>8F</td><td>92</td><td>9D</td><td>38</td>
                                <td>F5</td><td>BC</td><td>B6</td><td>DA</td><td>21</td><td>10</td><td>FF</td>
                                <td>F3</td><td>D2</td>
                            </tr>
                            <tr>
                                <th>8</th>
                                <td>CD</td><td>0C</td><td>13</td><td>EC</td><td>5F</td><td>97</td><td>44</td>
                                <td>17</td><td>C4</td><td>A7</td><td>7E</td><td>3D</td><td>64</td><td>5D</td>
                                <td>19</td><td>73</td>
                            </tr>
                            <tr>
                                <th>9</th>
                                <td>60</td><td>81</td><td>4F</td><td>DC</td><td>22</td><td>2A</td><td>90</td>
                                <td>88</td><td>46</td><td>EE</td><td>B8</td><td>14</td><td>DE</td><td>5E</td>
                                <td>0B</td><td>DB</td>
                            </tr>
                            <tr>
                                <th>A</th>
                                <td>E0</td><td>32</td><td>3A</td><td>0A</td><td>49</td><td>06</td><td>24</td>
                                <td>5C</td><td>C2</td><td>D3</td><td>AC</td><td>62</td><td>91</td><td>95</td>
                                <td>E4</td><td>79</td>
                            </tr>
                            <tr>
                                <th>B</th>
                                <td>E7</td><td>C8</td><td>37</td><td>6D</td><td>8D</td><td>D5</td><td>4E</td>
                                <td>A9</td><td>6C</td><td>56</td><td>F4</td><td>EA</td><td>65</td><td>7A</td>
                                <td>AE</td><td>08</td>
                            </tr>
                            <tr>
                                <th>C</th>
                                <td>BA</td><td>78</td><td>25</td><td>2E</td><td>1C</td><td>A6</td><td>B4</td>
                                <td>C6</td><td>E8</td><td>DD</td><td>74</td><td>1F</td><td>4B</td><td>BD</td>
                                <td>8B</td><td>8A</td>
                            </tr>
                            <tr>
                                <th>D</th>
                                <td>70</td><td>3E</td><td>B5</td><td>66</td><td>48</td><td>03</td><td>F6</td>
                                <td>0E</td><td>61</td><td>35</td><td>57</td><td>B9</td><td>86</td><td>C1</td>
                                <td>1D</td><td>9E</td>
                            </tr>
                            <tr>
                                <th>E</th>
                                <td>E1</td><td>F8</td><td>98</td><td>11</td><td>69</td><td>D9</td><td>8E</td>
                                <td>94</td><td>9B</td><td>1E</td><td>87</td><td>E9</td><td>CE</td><td>55</td>
                                <td>28</td><td>DF</td>
                            </tr>
                            <tr>
                                <th>F</th>
                                <td>8C</td><td>A1</td><td>89</td><td>0D</td><td>BF</td><td>E6</td><td>42</td>
                                <td>68</td><td>41</td><td>99</td><td>2D</td><td>0F</td><td>B0</td><td>54</td>
                                <td>BB</td><td>16</td>
                            </tr>
                        </table>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">Example: Input byte 53 → Look at row 5, column 3 → Output is ED</p>
                </div>
            </div>
          </div>

          <!-- 2. ShiftRows -->
          <div class="bg-white p-6 rounded mb-4">
            <p class="font-medium text-lg mb-3">2. ShiftRows Transformation:</p>
            <div class="mt-4">
                <p class="text-gray-600 mb-4 explanation-text">Each row is shifted cyclically to the left by a different number of positions:</p>
                <div class="space-y-6">
                    <div class="bg-purple-50 p-4 rounded">
                        <p class="font-medium mb-3 explanation-text">Row-by-Row Shifting:</p>
                        <div class="space-y-4">
                            <div class="flex items-center gap-4">
                                <span class="font-medium w-24">Row 1:</span>
                                <div class="bg-white p-2 rounded">
                                    <p class="explanation-text">No shift (0 positions)</p>
                                    <div class="grid grid-cols-4 gap-2 mt-1">
                                        <div class="bg-blue-100 p-2 text-center">a0</div>
                                        <div class="bg-blue-100 p-2 text-center">a1</div>
                                        <div class="bg-blue-100 p-2 text-center">a2</div>
                                        <div class="bg-blue-100 p-2 text-center">a3</div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="font-medium w-24">Row 2:</span>
                                <div class="bg-white p-2 rounded">
                                    <p class="explanation-text">Shift left by 1</p>
                                    <div class="grid grid-cols-4 gap-2 mt-1">
                                        <div class="bg-green-100 p-2 text-center">b1</div>
                                        <div class="bg-green-100 p-2 text-center">b2</div>
                                        <div class="bg-green-100 p-2 text-center">b3</div>
                                        <div class="bg-green-100 p-2 text-center">b0</div>
                                    </div>
                                    <div class="text-sm text-gray-500 mt-1">↑ b0 moves to end</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="font-medium w-24">Row 3:</span>
                                <div class="bg-white p-2 rounded">
                                    <p class="explanation-text">Shift left by 2</p>
                                    <div class="grid grid-cols-4 gap-2 mt-1">
                                        <div class="bg-yellow-100 p-2 text-center">c2</div>
                                        <div class="bg-yellow-100 p-2 text-center">c3</div>
                                        <div class="bg-yellow-100 p-2 text-center">c0</div>
                                        <div class="bg-yellow-100 p-2 text-center">c1</div>
                                    </div>
                                    <div class="text-sm text-gray-500 mt-1">↑ c0,c1 move to end</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="font-medium w-24">Row 4:</span>
                                <div class="bg-white p-2 rounded">
                                    <p class="explanation-text">Shift left by 3</p>
                                    <div class="grid grid-cols-4 gap-2 mt-1">
                                        <div class="bg-red-100 p-2 text-center">d3</div>
                                        <div class="bg-red-100 p-2 text-center">d0</div>
                                        <div class="bg-red-100 p-2 text-center">d1</div>
                                        <div class="bg-red-100 p-2 text-center">d2</div>
                                    </div>
                                    <div class="text-sm text-gray-500 mt-1">↑ d0,d1,d2 move to end</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
          </div>

          <!-- 3. MixColumns -->
          <div class="bg-white p-6 rounded mb-4">
            <p class="font-medium text-lg mb-3">3. MixColumns Transformation:</p>
            <div class="mt-4">
                <p class="text-gray-600 mb-4 explanation-text">Each column is transformed using matrix multiplication in Galois Field (2⁸):</p>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-purple-50 p-6 rounded">
                        <p class="font-medium mb-4 text-lg">Matrix Multiplication Formula:</p>
                        <div class="space-y-4 font-mono text-lg">
                            <div class="bg-white p-4 rounded">
                                <p class="font-medium mb-2 text-base">For each column:</p>
                                <p class="mb-2">Input bytes: [s0, s1, s2, s3]</p>
                                <p class="mb-2">Output bytes: [r0, r1, r2, r3]</p>
                            </div>
                            
                            <div class="bg-white p-4 rounded">
                                <p class="font-medium mb-2 text-base">Calculations:</p>
                                <div class="space-y-2">
                                    <p>r0 = (2 × s0) ⊕ (3 × s1) ⊕ (1 × s2) ⊕ (1 × s3)</p>
                                    <p>r1 = (1 × s0) ⊕ (2 × s1) ⊕ (3 × s2) ⊕ (1 × s3)</p>
                                    <p>r2 = (1 × s0) ⊕ (1 × s1) ⊕ (2 × s2) ⊕ (3 × s3)</p>
                                    <p>r3 = (3 × s0) ⊕ (1 × s1) ⊕ (1 × s2) ⊕ (2 × s3)</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 p-6 rounded">
                        <p class="font-medium mb-4 text-lg">Example with Real Values:</p>
                        <div class="space-y-4">
                            <div class="bg-white p-4 rounded">
                                <p class="font-medium mb-2">Input Column:</p>
                                <div class="grid grid-cols-4 gap-2 text-center">
                                    <div class="bg-gray-100 p-2">s0 = 87</div>
                                    <div class="bg-gray-100 p-2">s1 = F2</div>
                                    <div class="bg-gray-100 p-2">s2 = 4D</div>
                                    <div class="bg-gray-100 p-2">s3 = 97</div>
                                </div>
                            </div>

                            <div class="bg-white p-4 rounded">
                                <p class="font-medium mb-2">Step-by-Step Calculation for r0:</p>
                                <div class="space-y-2 font-mono">
                                    <p>2 × 87 = 0F</p>
                                    <p>3 × F2 = C1</p>
                                    <p>1 × 4D = 4D</p>
                                    <p>1 × 97 = 97</p>
                                    <div class="border-t pt-2 mt-2">
                                        <p>r0 = 0F ⊕ C1 ⊕ 4D ⊕ 97 = 47</p>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-green-50 p-4 rounded">
                                <p class="font-medium mb-2">Important Notes:</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Multiplication is in GF(2⁸)</li>
                                    <li>⊕ represents XOR operation</li>
                                    <li>Each byte is processed as a polynomial</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
          </div>

          <!-- 4. AddRoundKey -->
          <div class="bg-white p-6 rounded">
            <p class="font-medium text-lg mb-3">4. AddRoundKey Transformation:</p>
            <div class="mt-4">
                <p class="text-gray-600 mb-4 explanation-text">Each byte of the state is combined with a byte of the round key using XOR operation:</p>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-purple-50 p-4 rounded">
                        <p class="font-medium mb-3 explanation-text">Detailed Example:</p>
                        <div class="space-y-4">
                            <div class="bg-white p-3 rounded">
                                <p class="font-medium mb-2">State byte: 53</p>
                                <p class="font-mono text-lg">0101 0011</p>
                            </div>
                            <div class="text-center">⊕ (XOR)</div>
                            <div class="bg-white p-3 rounded">
                                <p class="font-medium mb-2">Round key: AF</p>
                                <p class="font-mono text-lg">1010 1111</p>
                            </div>
                            <div class="text-center">=</div>
                            <div class="bg-green-100 p-3 rounded">
                                <p class="font-medium mb-2">Result: FC</p>
                                <p class="font-mono text-lg">1111 1100</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded">
                        <p class="font-medium mb-3 explanation-text">XOR Rules:</p>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-white p-3 rounded text-center">
                                <p class="font-medium mb-2">0 ⊕ 0 = 0</p>
                                <p class="font-medium mb-2">1 ⊕ 0 = 1</p>
                                <p class="font-medium mb-2">0 ⊕ 1 = 1</p>
                                <p class="font-medium mb-2">1 ⊕ 1 = 0</p>
                            </div>
                            <div class="bg-white p-3 rounded">
                                <p class="font-medium mb-2">Key Properties:</p>
                                <ul class="list-disc list-inside text-sm space-y-2">
                                    <li>Reversible operation</li>
                                    <li>Self-inverse (A⊕A = 0)</li>
                                    <li>Easy to compute</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: Final Round -->
      <div class="card rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-2">3. Final Round</h3>
        <div class="info-box p-4 rounded-md mb-4">
          <p class="font-medium">Final Transformations:</p>
          <div class="space-y-2 mt-2">
            <div class="bg-white p-2 rounded">
              <p class="text-sm">Similar to main rounds but without MixColumns:</p>
              <ol class="list-decimal list-inside text-xs mt-1 text-gray-600">
                <li>SubBytes</li>
                <li>ShiftRows</li>
                <li>AddRoundKey</li>
              </ol>
            </div>
          </div>
        </div>
      </div>

      <!-- Final Result -->
      <div class="card rounded-lg p-6">
        <h3 class="text-lg font-semibold mb-2">4. Final Result</h3>
        <div class="info-box p-4 rounded-md mb-4">
          <p class="font-medium">Security Features:</p>
          <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
            <li>Strong confusion and diffusion</li>
            <li>Resistant to known attacks</li>
            <li>Mathematically proven security</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    document.addEventListener('DOMContentLoaded', async () => {
        let sessionId = getCookie('session_id');
        const userInfo = document.getElementById('userInfo');

        if (!sessionId) {
            userInfo.innerHTML = `<a href="../login.html"><button class="sign-in-btn">Sign In</button></a>`;
            return;
        }

        try {
            const response = await fetch('https://security-viz-api.onrender.com/check-session', {
                method: 'GET',
                headers: { 'X-Session-ID': sessionId, 'Accept': 'application/json' },
                credentials: 'include'
            });
            const data = await response.json();

            if (response.ok && data.authenticated) {
                userInfo.innerHTML = `<span class="welcome-text">Welcome, ${data.username}</span><button class="sign-in-btn" onclick="logout()">Logout</button>`;
            } else {
                document.cookie = 'session_id=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT';
                userInfo.innerHTML = `<a href="../login.html"><button class="sign-in-btn">Sign In</button></a>`;
            }
        } catch (error) {
            userInfo.innerHTML = `<a href="../login.html"><button class="sign-in-btn">Sign In</button></a>`;
        }
    });

    function closeOverallLeaderboard() {
        document.getElementById('leaderboardModal').style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    function showLeaderboard() {
        document.getElementById('leaderboardModal').style.display = 'block';
        document.body.style.overflow = 'hidden';
        fetchOverallLeaderboard();
    }
    function generateRandomKey() {
      const keySize = document.getElementById('keySize').value;
      const length = keySize / 8; // Convert bits to bytes
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()';
      let key = '';
      
      // Generate random key of appropriate length
      for (let i = 0; i < length; i++) {
        key += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      
      document.getElementById('keyInput').value = key;
    }

    function animateFlowStep(stepIndex, roundNumber = 1) {
        // Reset all steps
        document.querySelectorAll('.flow-step').forEach(step => {
            step.classList.remove('active');
        });
        document.querySelectorAll('.flow-arrow').forEach(arrow => {
            arrow.classList.remove('active');
        });

        // Get the current step and activate it
        const steps = document.querySelectorAll('.flow-step');
        if (steps[stepIndex]) {
            steps[stepIndex].classList.add('active');
            
            // Update round label if in main rounds
            const roundLabel = document.querySelector('.round-label');
            if (roundNumber >= 1 && roundNumber <= 9) {
                roundLabel.textContent = `Round ${roundNumber}`;
            }
        }
    }

    let currentStep = 0;
    let totalSteps = 0;
    let isEncrypting = true;
    let currentMessage = '';
    let currentKey = '';

    function startEncryption() {
        const message = document.getElementById('messageInput').value;
        const key = document.getElementById('keyInput').value;

        if (!message || !key) {
            alert('Please enter both message and key');
            return;
        }

        currentMessage = message;
        currentKey = key;
        isEncrypting = true;
        currentStep = 0;
        totalSteps = 11; // Initial round + 9 main rounds + final round

        // Show step navigation
        document.getElementById('stepNavigation').classList.remove('hidden');
        updateStepDisplay();

        // Clear previous visualizations
        clearVisualizations();

        // Show first step
        showStep(0);
    }

    function startDecryption() {
        const message = document.getElementById('messageInput').value;
        const key = document.getElementById('keyInput').value;

        if (!message || !key) {
            alert('Please enter both message and key');
            return;
        }

        currentMessage = message;
        currentKey = key;
        isEncrypting = false;
        currentStep = 0;
        totalSteps = 11; // Initial round + 9 main rounds + final round

        // Show step navigation
        document.getElementById('stepNavigation').classList.remove('hidden');
        updateStepDisplay();
        
        // Clear previous visualizations
        clearVisualizations();
        
        // Show first step
        showStep(0);
    }

    function updateStepDisplay() {
        document.getElementById('currentStep').textContent = `Step ${currentStep + 1} of ${totalSteps}`;
    }

    function nextStep() {
        if (currentStep < totalSteps - 1) {
            currentStep++;
            updateStepDisplay();
            showStep(currentStep);
        }
    }

    function previousStep() {
        if (currentStep > 0) {
            currentStep--;
            updateStepDisplay();
            showStep(currentStep);
        }
    }

    function showStep(step) {
        // Clear all visualizations first
        clearVisualizations();

        if (isEncrypting) {
            if (step === 0) {
                // Initial round
                showInitialRound(currentMessage, currentKey);
                animateFlowStep(0);
            } else if (step <= 9) {
                // Main rounds
                showMainRounds(currentMessage, currentKey, step);
                
                // Show all transformations for the current round
                showTransformationExplanation(0, step); // SubBytes
                showTransformationExplanation(1, step); // ShiftRows
                showTransformationExplanation(2, step); // MixColumns
                showTransformationExplanation(3, step); // AddRoundKey
                
                // Animate the current step in the flow diagram
                const subStep = (step - 1) % 4;
                animateFlowStep(subStep + 1, step);
            } else {
        // Final round
                showFinalRound(currentMessage, currentKey);
                
                // Show all transformations for the final round
                showTransformationExplanation(0, 10, true); // SubBytes
                showTransformationExplanation(1, 10, true); // ShiftRows
                showTransformationExplanation(3, 10, true); // AddRoundKey (no MixColumns in final round)
                
                // Animate the current step in the flow diagram
                const finalSubStep = step - 10;
                animateFlowStep(finalSubStep + 5);
                
                // Show final result on the last step
                if (step === totalSteps - 1) {
                    showFinalResult(currentMessage, currentKey, true);
                }
            }
        } else {
            // Decryption steps (reverse order)
            if (step === 0) {
                // Initial round
                showInitialRound(currentMessage, currentKey);
                animateFlowStep(0);
            } else if (step <= 9) {
                // Main rounds (reverse)
                const round = 10 - step;
                showMainRounds(currentMessage, currentKey, round, true);
                
                // Show all transformations for the current round in reverse order
                showTransformationExplanation(3, round, true); // AddRoundKey
                showTransformationExplanation(2, round, true); // MixColumns
                showTransformationExplanation(1, round, true); // ShiftRows
                showTransformationExplanation(0, round, true); // SubBytes
                
                // Animate the current step in the flow diagram
                const subStep = (step - 1) % 4;
                animateFlowStep(4 - subStep, round);
            } else {
                // Final round (reverse)
                showFinalRound(currentMessage, currentKey, true);
                
                // Show all transformations for the final round in reverse order
                showTransformationExplanation(3, 10, true); // AddRoundKey
                showTransformationExplanation(1, 10, true); // ShiftRows
                showTransformationExplanation(0, 10, true); // SubBytes
                
                // Animate the current step in the flow diagram
                const finalSubStep = step - 10;
                animateFlowStep(7 - finalSubStep);
                
                // Show final result on the last step
                if (step === totalSteps - 1) {
                    showFinalResult(currentMessage, currentKey, false);
                }
            }
        }
    }

    function showTransformationExplanation(step, round, isFinal = false) {
        const explanationDiv = document.createElement('div');
        explanationDiv.className = 'transformation-explanation bg-white p-6 rounded-lg shadow-lg mt-4 animate-fade';
        
        let explanation = '';
        
        if (isEncrypting) {
            switch(step) {
                case 0: // SubBytes
                    // Get the current state matrix
                    let subBytesState = [];
                    for (let i = 0; i < 4; i++) {
                        subBytesState[i] = [];
                        for (let j = 0; j < 4; j++) {
                            const index = i * 4 + j;
                            const char = currentMessage[index] || ' ';
                            const hex = char.charCodeAt(0).toString(16).padStart(2, '0');
                            subBytesState[i][j] = hex;
                        }
                    }
                    
                    // Apply transformations up to this point
                    if (round > 1) {
                        subBytesState = applyAddRoundKey(subBytesState, currentKey, round - 1);
                    }
                    
                    // Create example showing how SubBytes works
                    let beforeSubBytes = JSON.parse(JSON.stringify(subBytesState)); // Deep copy
                    let afterSubBytes = applySubBytes(subBytesState);
                    
                    // Find a non-zero byte for the example
                    let exampleByte = '';
                    let exampleRow = '';
                    let exampleCol = '';
                    let exampleResult = '';
                    
                    for (let i = 0; i < 4; i++) {
                        for (let j = 0; j < 4; j++) {
                            if (beforeSubBytes[i][j] !== '00') {
                                exampleByte = beforeSubBytes[i][j];
                                exampleRow = exampleByte.charAt(0);
                                exampleCol = exampleByte.charAt(1);
                                // Apply SubBytes to get the result
                                const sBox = [
                                    [0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76],
                                    [0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0],
                                    [0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15],
                                    [0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75],
                                    [0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84],
                                    [0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf],
                                    [0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8],
                                    [0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2],
                                    [0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73],
                                    [0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb],
                                    [0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79],
                                    [0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08],
                                    [0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a],
                                    [0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e],
                                    [0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf],
                                    [0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16]
                                ];
                                const row = parseInt(exampleRow, 16);
                                const col = parseInt(exampleCol, 16);
                                exampleResult = sBox[row][col].toString(16).padStart(2, '0').toUpperCase();
                                break;
                            }
                        }
                        if (exampleByte) break;
                    }
                    
                    // If no non-zero byte found, use a default example
                    if (!exampleByte) {
                        exampleByte = '53';
                        exampleRow = '5';
                        exampleCol = '3';
                        exampleResult = 'ED';
                    }
                    
                    explanation = `
                        <h3 class="text-xl font-bold mb-4">SubBytes Transformation (Round ${round})</h3>
                        <div class="space-y-4">
                            <p class="text-gray-700">Each byte in the state matrix is replaced using the S-box lookup table:</p>
                            <div class="bg-gray-50 p-4 rounded">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="font-medium mb-2">Example using your input:</p>
                                        <p>Input byte: ${exampleByte}</p>
                                        <p>1. Split into row (${exampleRow}) and column (${exampleCol})</p>
                                        <p>2. Look up in S-box table</p>
                                        <p>3. Output: ${exampleResult}</p>
                                        <div class="bg-purple-50 p-2 rounded mt-2">
                                            <p class="font-mono">${exampleByte} → ${exampleResult}</p>
                                            <p class="text-sm">(Row ${exampleRow}, Column ${exampleCol} in S-box)</p>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="font-medium mb-2">S-box Lookup Table:</p>
                                        <div class="overflow-x-auto">
                                            <table class="min-w-full text-xs">
                                                <thead>
                                                    <tr>
                                                        <th class="px-1 py-1 bg-gray-200"></th>
                                                        ${Array.from({length: 16}, (_, i) => 
                                                            `<th class="px-1 py-1 bg-gray-200">${i.toString(16).toUpperCase()}</th>`
                                                        ).join('')}
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    ${[
                                                        [0x63,0x7c,0x77,0x7b,0xf2,0x6b,0x6f,0xc5,0x30,0x01,0x67,0x2b,0xfe,0xd7,0xab,0x76],
                                                        [0xca,0x82,0xc9,0x7d,0xfa,0x59,0x47,0xf0,0xad,0xd4,0xa2,0xaf,0x9c,0xa4,0x72,0xc0],
                                                        [0xb7,0xfd,0x93,0x26,0x36,0x3f,0xf7,0xcc,0x34,0xa5,0xe5,0xf1,0x71,0xd8,0x31,0x15],
                                                        [0x04,0xc7,0x23,0xc3,0x18,0x96,0x05,0x9a,0x07,0x12,0x80,0xe2,0xeb,0x27,0xb2,0x75],
                                                        [0x09,0x83,0x2c,0x1a,0x1b,0x6e,0x5a,0xa0,0x52,0x3b,0xd6,0xb3,0x29,0xe3,0x2f,0x84],
                                                        [0x53,0xd1,0x00,0xed,0x20,0xfc,0xb1,0x5b,0x6a,0xcb,0xbe,0x39,0x4a,0x4c,0x58,0xcf],
                                                        [0xd0,0xef,0xaa,0xfb,0x43,0x4d,0x33,0x85,0x45,0xf9,0x02,0x7f,0x50,0x3c,0x9f,0xa8],
                                                        [0x51,0xa3,0x40,0x8f,0x92,0x9d,0x38,0xf5,0xbc,0xb6,0xda,0x21,0x10,0xff,0xf3,0xd2],
                                                        [0xcd,0x0c,0x13,0xec,0x5f,0x97,0x44,0x17,0xc4,0xa7,0x7e,0x3d,0x64,0x5d,0x19,0x73],
                                                        [0x60,0x81,0x4f,0xdc,0x22,0x2a,0x90,0x88,0x46,0xee,0xb8,0x14,0xde,0x5e,0x0b,0xdb],
                                                        [0xe0,0x32,0x3a,0x0a,0x49,0x06,0x24,0x5c,0xc2,0xd3,0xac,0x62,0x91,0x95,0xe4,0x79],
                                                        [0xe7,0xc8,0x37,0x6d,0x8d,0xd5,0x4e,0xa9,0x6c,0x56,0xf4,0xea,0x65,0x7a,0xae,0x08],
                                                        [0xba,0x78,0x25,0x2e,0x1c,0xa6,0xb4,0xc6,0xe8,0xdd,0x74,0x1f,0x4b,0xbd,0x8b,0x8a],
                                                        [0x70,0x3e,0xb5,0x66,0x48,0x03,0xf6,0x0e,0x61,0x35,0x57,0xb9,0x86,0xc1,0x1d,0x9e],
                                                        [0xe1,0xf8,0x98,0x11,0x69,0xd9,0x8e,0x94,0x9b,0x1e,0x87,0xe9,0xce,0x55,0x28,0xdf],
                                                        [0x8c,0xa1,0x89,0x0d,0xbf,0xe6,0x42,0x68,0x41,0x99,0x2d,0x0f,0xb0,0x54,0xbb,0x16]
                                                    ].map((row, i) => `
                                                        <tr>
                                                            <td class="px-1 py-1 bg-gray-200 font-medium">${i.toString(16).toUpperCase()}</td>
                                                            ${row.map((val, j) => {
                                                                const isHighlighted = i.toString(16).toUpperCase() === exampleRow && 
                                                                                    j.toString(16).toUpperCase() === exampleCol;
                                                                return `<td class="px-1 py-1 text-center ${
                                                                    isHighlighted ? 'bg-yellow-200 font-bold' : 'bg-white'
                                                                }">${val.toString(16).padStart(2, '0').toUpperCase()}</td>`;
                                                            }).join('')}
                                                        </tr>
                                                    `).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                        <p class="text-sm mt-2 text-gray-600">The highlighted cell shows where ${exampleByte} is transformed to ${exampleResult}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 1: // ShiftRows
                    // Get the current state matrix
                    let shiftRowsState = [];
                    for (let i = 0; i < 4; i++) {
                        shiftRowsState[i] = [];
                        for (let j = 0; j < 4; j++) {
                            const index = i * 4 + j;
                            const char = currentMessage[index] || ' ';
                            const hex = char.charCodeAt(0).toString(16).padStart(2, '0');
                            shiftRowsState[i][j] = hex;
                        }
                    }
                    
                    // Apply transformations up to this point
                    if (round > 1) {
                        shiftRowsState = applyAddRoundKey(shiftRowsState, currentKey, round - 1);
                    }
                    shiftRowsState = applySubBytes(shiftRowsState);
                    
                    // Create example showing how ShiftRows works
                    let beforeShiftRows = JSON.parse(JSON.stringify(shiftRowsState)); // Deep copy
                    let afterShiftRows = applyShiftRows(shiftRowsState);
                    
                    // Get the values for each row before and after shifting
                    let row1Before = [beforeShiftRows[0][0], beforeShiftRows[0][1], beforeShiftRows[0][2], beforeShiftRows[0][3]];
                    let row2Before = [beforeShiftRows[1][0], beforeShiftRows[1][1], beforeShiftRows[1][2], beforeShiftRows[1][3]];
                    let row3Before = [beforeShiftRows[2][0], beforeShiftRows[2][1], beforeShiftRows[2][2], beforeShiftRows[2][3]];
                    let row4Before = [beforeShiftRows[3][0], beforeShiftRows[3][1], beforeShiftRows[3][2], beforeShiftRows[3][3]];
                    
                    let row1After = [afterShiftRows[0][0], afterShiftRows[0][1], afterShiftRows[0][2], afterShiftRows[0][3]];
                    let row2After = [afterShiftRows[1][0], afterShiftRows[1][1], afterShiftRows[1][2], afterShiftRows[1][3]];
                    let row3After = [afterShiftRows[2][0], afterShiftRows[2][1], afterShiftRows[2][2], afterShiftRows[2][3]];
                    let row4After = [afterShiftRows[3][0], afterShiftRows[3][1], afterShiftRows[3][2], afterShiftRows[3][3]];
                    
                    explanation = `
                        <h3 class="text-xl font-bold mb-4">ShiftRows Transformation (Round ${round})</h3>
                        <div class="space-y-4">
                            <p class="text-gray-700">Each row is shifted cyclically to the left by a different number of positions:</p>
                            <div class="bg-gray-50 p-4 rounded">
                                <div class="grid grid-cols-4 gap-2 mb-4">
                                    <div class="text-center">
                                        <p class="font-medium">Row 1</p>
                                        <p class="text-sm">No shift (0 positions)</p>
                                        <div class="bg-blue-100 p-2 mt-1">[${row1Before.join(' ')}]</div>
                                        <div class="bg-blue-50 p-2 mt-1">[${row1After.join(' ')}]</div>
                                    </div>
                                    <div class="text-center">
                                        <p class="font-medium">Row 2</p>
                                        <p class="text-sm">Shift left by 1</p>
                                        <div class="bg-green-100 p-2 mt-1">[${row2Before.join(' ')}]</div>
                                        <div class="bg-green-50 p-2 mt-1">[${row2After.join(' ')}]</div>
                                    </div>
                                    <div class="text-center">
                                        <p class="font-medium">Row 3</p>
                                        <p class="text-sm">Shift left by 2</p>
                                        <div class="bg-yellow-100 p-2 mt-1">[${row3Before.join(' ')}]</div>
                                        <div class="bg-yellow-50 p-2 mt-1">[${row3After.join(' ')}]</div>
                                    </div>
                                    <div class="text-center">
                                        <p class="font-medium">Row 4</p>
                                        <p class="text-sm">Shift left by 3</p>
                                        <div class="bg-red-100 p-2 mt-1">[${row4Before.join(' ')}]</div>
                                        <div class="bg-red-50 p-2 mt-1">[${row4After.join(' ')}]</div>
                                    </div>
                                </div>
                                <p class="text-sm mt-2">Each row is shifted left by its row number minus 1 positions</p>
                            </div>
                        </div>
                    `;
                    break;
                case 2: // MixColumns
                    // Get the current state matrix
                    let mixColumnsState = [];
                    for (let i = 0; i < 4; i++) {
                        mixColumnsState[i] = [];
                        for (let j = 0; j < 4; j++) {
                            const index = i * 4 + j;
                            const char = currentMessage[index] || ' ';
                            const hex = char.charCodeAt(0).toString(16).padStart(2, '0');
                            mixColumnsState[i][j] = hex;
                        }
                    }
                    
                    // Apply transformations up to this point
                    if (round > 1) {
                        mixColumnsState = applyAddRoundKey(mixColumnsState, currentKey, round - 1);
                    }
                    mixColumnsState = applySubBytes(mixColumnsState);
                    mixColumnsState = applyShiftRows(mixColumnsState);
                    
                    // Create example showing how MixColumns works
                    let beforeMixColumns = JSON.parse(JSON.stringify(mixColumnsState)); // Deep copy
                    let afterMixColumns = applyMixColumns(mixColumnsState);
                    
                    // Get the values for the first column (as an example)
                    let s0 = beforeMixColumns[0][0];
                    let s1 = beforeMixColumns[1][0];
                    let s2 = beforeMixColumns[2][0];
                    let s3 = beforeMixColumns[3][0];
                    
                    let r0 = afterMixColumns[0][0];
                    let r1 = afterMixColumns[1][0];
                    let r2 = afterMixColumns[2][0];
                    let r3 = afterMixColumns[3][0];
                    
                    explanation = `
                        <h3 class="text-xl font-bold mb-4">MixColumns Transformation (Round ${round})</h3>
                        <div class="space-y-4">
                            <p class="text-gray-700">Each column is transformed using matrix multiplication in GF(2⁸):</p>
                            <div class="bg-gray-50 p-4 rounded">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="font-medium mb-2">Matrix Multiplication:</p>
                                        <div class="space-y-2 font-mono text-sm">
                                            <p>r₀ = (2 × ${s0}) ⊕ (3 × ${s1}) ⊕ (1 × ${s2}) ⊕ (1 × ${s3}) = ${r0}</p>
                                            <p>r₁ = (1 × ${s0}) ⊕ (2 × ${s1}) ⊕ (3 × ${s2}) ⊕ (1 × ${s3}) = ${r1}</p>
                                            <p>r₂ = (1 × ${s0}) ⊕ (1 × ${s1}) ⊕ (2 × ${s2}) ⊕ (3 × ${s3}) = ${r2}</p>
                                            <p>r₃ = (3 × ${s0}) ⊕ (1 × ${s1}) ⊕ (1 × ${s2}) ⊕ (2 × ${s3}) = ${r3}</p>
                                        </div>
                                        <div class="mt-4">
                                            <p class="font-medium mb-2">Before MixColumns:</p>
                                            <div class="grid grid-cols-4 gap-1 font-mono text-sm">
                                                ${stateMatrixToHTML(beforeMixColumns)}
                                            </div>
                                            <p class="font-medium mt-4 mb-2">After MixColumns:</p>
                                            <div class="grid grid-cols-4 gap-1 font-mono text-sm">
                                                ${stateMatrixToHTML(afterMixColumns)}
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="font-medium mb-2">Multiplication in GF(2⁸):</p>
                                        <div class="space-y-2 text-sm">
                                            <p>• Multiplication by 1: No change</p>
                                            <p>• Multiplication by 2: Left shift by 1 bit</p>
                                            <p>• Multiplication by 3: Left shift by 1 bit ⊕ original value</p>
                                            <p class="mt-2">Example for first column:</p>
                                            <div class="bg-blue-50 p-2 rounded">
                                                <p class="font-mono">Input: [${s0} ${s1} ${s2} ${s3}]</p>
                                                <p class="font-mono">Output: [${r0} ${r1} ${r2} ${r3}]</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 3: // AddRoundKey
                    // Get the current state matrix
                    let addRoundKeyState = [];
                    for (let i = 0; i < 4; i++) {
                        addRoundKeyState[i] = [];
                        for (let j = 0; j < 4; j++) {
                            const index = i * 4 + j;
                            const char = currentMessage[index] || ' ';
                            const hex = char.charCodeAt(0).toString(16).padStart(2, '0');
                            addRoundKeyState[i][j] = hex;
                        }
                    }
                    
                    // Apply transformations up to this point
                    if (round > 1) {
                        addRoundKeyState = applyAddRoundKey(addRoundKeyState, currentKey, round - 1);
                    }
                    addRoundKeyState = applySubBytes(addRoundKeyState);
                    addRoundKeyState = applyShiftRows(addRoundKeyState);
                    addRoundKeyState = applyMixColumns(addRoundKeyState);
                    
                    // Create example showing how AddRoundKey works
                    let beforeAddRoundKey = JSON.parse(JSON.stringify(addRoundKeyState)); // Deep copy
                    let afterAddRoundKey = applyAddRoundKey(addRoundKeyState, currentKey, round);
                    
                    // Find a position with non-zero values for the example
                    let addRoundKeyRow = 0;
                    let addRoundKeyCol = 0;
                    let stateByte = '';
                    let keyByte = '';
                    let resultByte = '';
                    
                    for (let i = 0; i < 4; i++) {
                        for (let j = 0; j < 4; j++) {
                            if (beforeAddRoundKey[i][j] !== '00') {
                                addRoundKeyRow = i;
                                addRoundKeyCol = j;
                                stateByte = beforeAddRoundKey[i][j];
                                
                                // Get the key byte
                                const keyChar = currentKey[(i * 4 + j) % currentKey.length] || ' ';
                                keyByte = keyChar.charCodeAt(0).toString(16).padStart(2, '0');
                                
                                resultByte = afterAddRoundKey[i][j];
                                break;
                            }
                        }
                        if (stateByte) break;
                    }
                    
                    // If no non-zero byte found, use a default example
                    if (!stateByte) {
                        stateByte = '53';
                        keyByte = 'AF';
                        resultByte = 'FC';
                    }
                    
                    explanation = `
                        <h3 class="text-xl font-bold mb-4">AddRoundKey Transformation (Round ${round})</h3>
                        <div class="space-y-4">
                            <p class="text-gray-700">Each byte of the state is combined with a byte of the round key using XOR:</p>
                            <div class="bg-gray-50 p-4 rounded">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="font-medium mb-2">XOR Operation Example:</p>
                                        <div class="space-y-2">
                                            <p>State byte: ${stateByte}</p>
                                            <p class="font-mono">${parseInt(stateByte, 16).toString(2).padStart(8, '0')}</p>
                                            <p>Round key: ${keyByte}</p>
                                            <p class="font-mono">${parseInt(keyByte, 16).toString(2).padStart(8, '0')}</p>
                                            <p>Result: ${resultByte}</p>
                                            <p class="font-mono">${parseInt(resultByte, 16).toString(2).padStart(8, '0')}</p>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="font-medium mb-2">XOR Rules:</p>
                                        <div class="grid grid-cols-2 gap-2">
                                            <div class="bg-white p-2 rounded text-center">
                                                <p>0 ⊕ 0 = 0</p>
                                                <p>1 ⊕ 0 = 1</p>
                                                <p>0 ⊕ 1 = 1</p>
                                                <p>1 ⊕ 1 = 0</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
        } else {
            // Decryption explanations (inverse operations)
            switch(step) {
                case 0: // Inverse SubBytes
                    explanation = `
                        <h3 class="text-xl font-bold mb-4">Inverse SubBytes Transformation (Round ${round})</h3>
                        <div class="space-y-4">
                            <p class="text-gray-700">Each byte is replaced using the inverse S-box lookup table:</p>
                            <div class="bg-gray-50 p-4 rounded">
                                <p class="font-medium mb-2">Example:</p>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="mb-2">Input byte: ED</p>
                                        <p>1. Split into row (E) and column (D)</p>
                                        <p>2. Look up in inverse S-box table</p>
                                        <p>3. Output: 53</p>
                                    </div>
                                    <div class="bg-purple-50 p-2 rounded">
                                        <p class="font-mono">ED → 53</p>
                                        <p class="text-sm">(Row E, Column D in inverse S-box)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 1: // Inverse ShiftRows
                    explanation = `
                        <h3 class="text-xl font-bold mb-4">Inverse ShiftRows Transformation (Round ${round})</h3>
                        <div class="space-y-4">
                            <p class="text-gray-700">Each row is shifted cyclically to the right by a different number of positions:</p>
                            <div class="bg-gray-50 p-4 rounded">
                                <div class="grid grid-cols-4 gap-2 mb-4">
                                    <div class="text-center">
                                        <p class="font-medium">Row 1</p>
                                        <p class="text-sm">No shift (0 positions)</p>
                                        <div class="bg-blue-100 p-2 mt-1">[a0 a1 a2 a3]</div>
                                    </div>
                                    <div class="text-center">
                                        <p class="font-medium">Row 2</p>
                                        <p class="text-sm">Shift right by 1</p>
                                        <div class="bg-green-100 p-2 mt-1">[b3 b0 b1 b2]</div>
                                    </div>
                                    <div class="text-center">
                                        <p class="font-medium">Row 3</p>
                                        <p class="text-sm">Shift right by 2</p>
                                        <div class="bg-yellow-100 p-2 mt-1">[c2 c3 c0 c1]</div>
                                    </div>
                                    <div class="text-center">
                                        <p class="font-medium">Row 4</p>
                                        <p class="text-sm">Shift right by 3</p>
                                        <div class="bg-red-100 p-2 mt-1">[d1 d2 d3 d0]</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 2: // Inverse MixColumns
                    explanation = `
                        <h3 class="text-xl font-bold mb-4">Inverse MixColumns Transformation (Round ${round})</h3>
                        <div class="space-y-4">
                            <p class="text-gray-700">Each column is transformed using inverse matrix multiplication in GF(2⁸):</p>
                            <div class="bg-gray-50 p-4 rounded">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="font-medium mb-2">Inverse Matrix Multiplication:</p>
                                        <div class="font-mono space-y-1">
                                            <p>r0 = (E × s0) ⊕ (B × s1) ⊕ (D × s2) ⊕ (9 × s3)</p>
                                            <p>r1 = (9 × s0) ⊕ (E × s1) ⊕ (B × s2) ⊕ (D × s3)</p>
                                            <p>r2 = (D × s0) ⊕ (9 × s1) ⊕ (E × s2) ⊕ (B × s3)</p>
                                            <p>r3 = (B × s0) ⊕ (D × s1) ⊕ (9 × s2) ⊕ (E × s3)</p>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="font-medium mb-2">Example Calculation:</p>
                                        <div class="space-y-2">
                                            <p>Input: [47 6E 1A 5B]</p>
                                            <p>E × 47 = 8F</p>
                                            <p>B × 6E = 3D</p>
                                            <p>D × 1A = 2C</p>
                                            <p>9 × 5B = 4A</p>
                                            <p class="font-bold">Result: 8F ⊕ 3D ⊕ 2C ⊕ 4A = 87</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 3: // Inverse AddRoundKey
                    explanation = `
                        <h3 class="text-xl font-bold mb-4">Inverse AddRoundKey Transformation (Round ${round})</h3>
                        <div class="space-y-4">
                            <p class="text-gray-700">Same as AddRoundKey (XOR is its own inverse):</p>
                            <div class="bg-gray-50 p-4 rounded">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="font-medium mb-2">XOR Operation Example:</p>
                                        <div class="space-y-2">
                                            <p>State byte: FC</p>
                                            <p class="font-mono">1111 1100</p>
                                            <p>Round key: AF</p>
                                            <p class="font-mono">1010 1111</p>
                                            <p>Result: 53</p>
                                            <p class="font-mono">0101 0011</p>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="font-medium mb-2">XOR Properties:</p>
                                        <div class="space-y-2">
                                            <p>• A ⊕ A = 0</p>
                                            <p>• A ⊕ 0 = A</p>
                                            <p>• (A ⊕ B) ⊕ B = A</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
        }

        explanationDiv.innerHTML = explanation;
        document.querySelector('.container').appendChild(explanationDiv);
    }

    function showInitialRound(message, key) {
        const initialRound = document.getElementById('initialRound');
        initialRound.innerHTML = `
            <div class="bg-white p-4 rounded-md animate-fade">
                <p class="font-medium mb-2">Initial State:</p>
                <div class="grid grid-cols-4 gap-1 font-mono text-sm">
                    ${generateStateMatrix(message)}
                </div>
                <p class="font-medium mt-4 mb-2">After AddRoundKey:</p>
                <div class="grid grid-cols-4 gap-1 font-mono text-sm">
                    ${generateStateMatrix(message, true, 0, 'addRoundKey')}
                </div>
            </div>
        `;
    }

    function showMainRounds(message, key, currentRound) {
        const mainRounds = document.getElementById('mainRounds');
        const roundContent = `
            <div class="round-entry p-4 animate-fade">
                <h4 class="font-medium mb-2">Round ${currentRound}</h4>
                <div class="space-y-4">
                    ${generateRoundSteps(message, key, currentRound)}
                </div>
            </div>
        `;
        
        // Append or update round content
        if (currentRound === 1) {
            mainRounds.innerHTML = roundContent;
        } else {
            mainRounds.innerHTML += roundContent;
        }

        // Scroll to the latest round
        const roundsContainer = document.querySelector('.rounds-container');
        roundsContainer.scrollTop = roundsContainer.scrollHeight;
    }

    function showFinalRound(message, key) {
        const finalRound = document.getElementById('finalRound');
        finalRound.innerHTML = `
            <div class="bg-white p-4 rounded-md animate-fade">
                <p class="font-medium mb-2">Final Transformations:</p>
                <div class="space-y-2">
                    ${generateFinalSteps(message, key)}
                </div>
            </div>
        `;
    }

    function showFinalResult(message, key, isEncrypt) {
        const finalResult = document.getElementById('finalResult');
        const result = isEncrypt ? encryptAES(message, key) : decryptAES(message, key);
        
        finalResult.innerHTML = `
            <div class="bg-white p-4 rounded-md animate-fade">
                <p class="font-medium mb-2">Final ${isEncrypt ? 'Encrypted' : 'Decrypted'} Result:</p>
                <p class="font-mono bg-purple-50 p-2 rounded break-all">${result}</p>
            </div>
        `;
    }

    function clearVisualizations() {
        document.getElementById('initialRound').innerHTML = '';
        document.getElementById('mainRounds').innerHTML = '';
        document.getElementById('finalRound').innerHTML = '';
        document.getElementById('finalResult').innerHTML = '';
    }

    // Helper functions for visualization
    function generateStateMatrix(text, isModified = false, round = 0, transformation = '') {
        let matrix = '';
        let state = [];
        
        // Create initial state matrix
        for (let i = 0; i < 4; i++) {
            state[i] = [];
            for (let j = 0; j < 4; j++) {
                const index = i * 4 + j;
                const char = text[index] || ' ';
            const hex = char.charCodeAt(0).toString(16).padStart(2, '0');
                state[i][j] = hex;
            }
        }
        
        // Apply transformations based on the current step
        if (transformation === 'subBytes') {
            state = applySubBytes(state);
        } else if (transformation === 'shiftRows') {
            state = applyShiftRows(state);
        } else if (transformation === 'mixColumns') {
            state = applyMixColumns(state);
        } else if (transformation === 'addRoundKey') {
            state = applyAddRoundKey(state, text, round);
        }
        
        // Convert state matrix to HTML
        for (let i = 0; i < 4; i++) {
            for (let j = 0; j < 4; j++) {
                const hex = state[i][j];
            matrix += `
                <div class="bg-${isModified ? 'purple' : 'gray'}-50 p-1 text-center">
                    ${hex}
                </div>
            `;
        }
        }
        
        return matrix;
    }
    
    // Apply SubBytes transformation
    function applySubBytes(state) {
        const sBox = [
            [0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76],
            [0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0],
            [0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15],
            [0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75],
            [0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84],
            [0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf],
            [0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8],
            [0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2],
            [0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73],
            [0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb],
            [0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79],
            [0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08],
            [0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a],
            [0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e],
            [0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf],
            [0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16]
        ];
        
        let newState = [];
        for (let i = 0; i < 4; i++) {
            newState[i] = [];
            for (let j = 0; j < 4; j++) {
                const hex = state[i][j];
                const row = parseInt(hex.charAt(0), 16);
                const col = parseInt(hex.charAt(1), 16);
                newState[i][j] = sBox[row][col].toString(16).padStart(2, '0');
            }
        }
        
        return newState;
    }
    
    // Apply ShiftRows transformation
    function applyShiftRows(state) {
        let newState = [];
        for (let i = 0; i < 4; i++) {
            newState[i] = [];
            for (let j = 0; j < 4; j++) {
                // Row 0: no shift
                // Row 1: shift left by 1
                // Row 2: shift left by 2
                // Row 3: shift left by 3
                const shift = i;
                const newCol = (j + shift) % 4;
                newState[i][j] = state[i][newCol];
            }
        }
        
        return newState;
    }
    
    // Apply MixColumns transformation (simplified for visualization)
    function applyMixColumns(state) {
        let newState = [];
        for (let i = 0; i < 4; i++) {
            newState[i] = [];
            for (let j = 0; j < 4; j++) {
                // Simplified MixColumns: just add a small offset to each byte
                const hex = state[i][j];
                const val = parseInt(hex, 16);
                const newVal = (val + 10) % 256; // Add 10 and wrap around
                newState[i][j] = newVal.toString(16).padStart(2, '0');
            }
        }
        
        return newState;
    }
    
    // Apply AddRoundKey transformation
    function applyAddRoundKey(state, key, round) {
        let newState = [];
        for (let i = 0; i < 4; i++) {
            newState[i] = [];
            for (let j = 0; j < 4; j++) {
                const hex = state[i][j];
                const keyChar = key[(i * 4 + j) % key.length] || ' ';
                const keyHex = keyChar.charCodeAt(0).toString(16).padStart(2, '0');
                
                // XOR the state byte with the key byte
                const val1 = parseInt(hex, 16);
                const val2 = parseInt(keyHex, 16);
                const xored = val1 ^ val2;
                newState[i][j] = xored.toString(16).padStart(2, '0');
            }
        }
        
        return newState;
    }

    function generateRoundSteps(message, key, round) {
        let currentState = [];
        let steps = '';
        
        // Create initial state matrix
        for (let i = 0; i < 4; i++) {
            currentState[i] = [];
            for (let j = 0; j < 4; j++) {
                const index = i * 4 + j;
                const char = message[index] || ' ';
                const hex = char.charCodeAt(0).toString(16).padStart(2, '0');
                currentState[i][j] = hex;
            }
        }
        
        // Apply AddRoundKey from previous round if not round 1
        if (round > 1) {
            currentState = applyAddRoundKey(currentState, key, round - 1);
        }
        
        // SubBytes
        let beforeSubBytes = JSON.parse(JSON.stringify(currentState));
        currentState = applySubBytes(currentState);
        steps += `
            <div class="step-entry p-2">
                <p class="font-medium">1. SubBytes:</p>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <p class="text-sm">Before:</p>
                <div class="grid grid-cols-4 gap-1 font-mono text-sm">
                            ${stateMatrixToHTML(beforeSubBytes)}
                </div>
                    </div>
                    <div>
                        <p class="text-sm">After:</p>
                        <div class="grid grid-cols-4 gap-1 font-mono text-sm">
                            ${stateMatrixToHTML(currentState)}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // ShiftRows
        let beforeShiftRows = JSON.parse(JSON.stringify(currentState));
        currentState = applyShiftRows(currentState);
        steps += `
            <div class="step-entry p-2">
                <p class="font-medium">2. ShiftRows:</p>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <p class="text-sm">Before:</p>
                <div class="grid grid-cols-4 gap-1 font-mono text-sm">
                            ${stateMatrixToHTML(beforeShiftRows)}
                </div>
                    </div>
                    <div>
                        <p class="text-sm">After:</p>
                        <div class="grid grid-cols-4 gap-1 font-mono text-sm">
                            ${stateMatrixToHTML(currentState)}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // MixColumns
        let beforeMixColumns = JSON.parse(JSON.stringify(currentState));
        currentState = applyMixColumns(currentState);
        steps += `
            <div class="step-entry p-2">
                <p class="font-medium">3. MixColumns:</p>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <p class="text-sm">Before:</p>
                <div class="grid grid-cols-4 gap-1 font-mono text-sm">
                            ${stateMatrixToHTML(beforeMixColumns)}
                </div>
                    </div>
                    <div>
                        <p class="text-sm">After:</p>
                        <div class="grid grid-cols-4 gap-1 font-mono text-sm">
                            ${stateMatrixToHTML(currentState)}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // AddRoundKey
        let beforeAddRoundKey = JSON.parse(JSON.stringify(currentState));
        currentState = applyAddRoundKey(currentState, key, round);
        steps += `
            <div class="step-entry p-2">
                <p class="font-medium">4. AddRoundKey:</p>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <p class="text-sm">Before:</p>
                <div class="grid grid-cols-4 gap-1 font-mono text-sm">
                            ${stateMatrixToHTML(beforeAddRoundKey)}
                        </div>
                    </div>
                    <div>
                        <p class="text-sm">After:</p>
                        <div class="grid grid-cols-4 gap-1 font-mono text-sm">
                            ${stateMatrixToHTML(currentState)}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        return steps;
    }

    // Helper function to convert state matrix to HTML
    function stateMatrixToHTML(state) {
        let html = '';
        for (let i = 0; i < 4; i++) {
            for (let j = 0; j < 4; j++) {
                html += `
                    <div class="bg-gray-50 p-1 text-center">
                        ${state[i][j]}
                    </div>
                `;
            }
        }
        return html;
    }

    function generateFinalSteps(message, key) {
        // Create initial state matrix
        let state = [];
        for (let i = 0; i < 4; i++) {
            state[i] = [];
            for (let j = 0; j < 4; j++) {
                const index = i * 4 + j;
                const char = message[index] || ' ';
                const hex = char.charCodeAt(0).toString(16).padStart(2, '0');
                state[i][j] = hex;
            }
        }
        
        // Apply AddRoundKey from previous round
        state = applyAddRoundKey(state, key, 9);
        
        // Apply SubBytes
        state = applySubBytes(state);
        
        // Apply ShiftRows
        state = applyShiftRows(state);
        
        // Apply AddRoundKey
        state = applyAddRoundKey(state, key, 10);
        
        return `
            <div class="grid grid-cols-4 gap-1 font-mono text-xs">
                ${stateMatrixToHTML(state, true)}
            </div>
        `;
    }

    // Simplified AES operations (for demonstration)
    function encryptAES(message, key) {
        // This is a simplified version for visualization
        return Array.from(message)
            .map(char => char.charCodeAt(0).toString(16).padStart(2, '0'))
            .join('');
    }

    function decryptAES(message, key) {
        // This is a simplified version for visualization
        let result = '';
        for (let i = 0; i < message.length; i += 2) {
            result += String.fromCharCode(parseInt(message.substr(i, 2), 16));
        }
        return result;
    }

    function drawAESVisualization(canvas, currentRound, message, isEncrypt) {
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        const startY = 50;
        const boxSize = 40;
        const spacing = 80;
        
        // Draw title
        ctx.fillStyle = '#1F2937';
        ctx.font = 'bold 16px Inter';
        ctx.fillText(`AES ${isEncrypt ? 'Encryption' : 'Decryption'} - Round ${currentRound}/10`, 20, 30);

        // Draw state matrix progression
        let currentY = startY;
        
        // Initial state
        drawStateMatrix(ctx, 50, currentY, message, 'Initial State');
        currentY += spacing;

        // SubBytes
        if (currentRound > 0) {
            drawTransformation(ctx, currentY, 'SubBytes');
            drawStateMatrix(ctx, 50, currentY + 30, message, 'After SubBytes');
            currentY += spacing;
        }

        // ShiftRows
        if (currentRound > 1) {
            drawTransformation(ctx, currentY, 'ShiftRows');
            drawStateMatrix(ctx, 50, currentY + 30, message, 'After ShiftRows');
            currentY += spacing;
        }

        // MixColumns
        if (currentRound > 2) {
            drawTransformation(ctx, currentY, 'MixColumns');
            drawStateMatrix(ctx, 50, currentY + 30, message, 'After MixColumns');
            currentY += spacing;
        }

        // AddRoundKey
        if (currentRound > 3) {
            drawTransformation(ctx, currentY, 'AddRoundKey');
            drawStateMatrix(ctx, 50, currentY + 30, message, 'After AddRoundKey');
        }
    }

    function drawStateMatrix(ctx, x, y, data, label) {
        ctx.fillStyle = '#4B5563';
        ctx.font = '12px Inter';
        ctx.fillText(label, x, y - 5);

        ctx.fillStyle = '#8B5CF6';
        for (let i = 0; i < 4; i++) {
            for (let j = 0; j < 4; j++) {
                ctx.fillRect(x + j * 30, y + i * 30, 25, 25);
            }
        }
    }

    function drawTransformation(ctx, y, label) {
        ctx.fillStyle = '#4B5563';
        ctx.font = '14px Inter';
        ctx.fillText(`↓ ${label}`, 50, y);
    }

    function toggleExample() {
        const exampleContent = document.getElementById('exampleContent');
        exampleContent.classList.toggle('hidden');
        
        if (!exampleContent.classList.contains('hidden')) {
          // Scroll to the example content with smooth behavior
          exampleContent.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
          });
        }
    }

    function scrollToShiftRowsExplanation() {
      // Get the current step number
      const currentStep = document.getElementById('currentStep').textContent;
      const stepNumber = parseInt(currentStep.replace('Step ', ''));
      
      // Show the transformation explanation for the current step
      showTransformationExplanation('shiftRows', stepNumber);
      
      // Find the transformation explanation section in the main visualization
      const transformationExplanation = document.querySelector('.transformation-explanation');
      if (transformationExplanation) {
        transformationExplanation.scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
      }
    }

    async function fetchOverallLeaderboard() {
        const sessionId = getCookie('session_id');
        try {
            const response = await fetch('https://security-viz-api.onrender.com/get-overall-leaderboard', {
                method: 'GET',
                headers: {
                    'X-Session-ID': sessionId,
                    'Accept': 'application/json'
                },
                credentials: 'include'
            });
            
            if (!response.ok) {
                throw new Error('Failed to fetch leaderboard');
            }
            
            const data = await response.json();
            if (data.leaderboard && Array.isArray(data.leaderboard)) {
                updateOverallLeaderboard(data.leaderboard);
            } else {
                throw new Error('Invalid leaderboard data');
            }
        } catch (error) {
            console.error('Error fetching overall leaderboard:', error);
            const tbody = document.getElementById('leaderboardTable').querySelector('tbody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="4" style="text-align: center; color: #ff4444;">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>Failed to load leaderboard. Please try again later.</p>
                    </td>
                </tr>
            `;
        }
    }

    function updateOverallLeaderboard(leaderboardData) {
        const tbody = document.getElementById('leaderboardTable').querySelector('tbody');
        tbody.innerHTML = '';

        if (leaderboardData.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="4" style="text-align: center;">
                        <i class="fas fa-info-circle"></i>
                        <p>No scores available yet. Complete some quizzes to appear on the leaderboard!</p>
                    </td>
                </tr>
            `;
            return;
        }

        leaderboardData.forEach((user, index) => {
            const row = document.createElement('tr');
            const rank = index + 1;
            let rankDisplay = rank.toString();
            
            if (rank === 1) rankDisplay = '🥇 1';
            else if (rank === 2) rankDisplay = '🥈 2';
            else if (rank === 3) rankDisplay = '🥉 3';
            
            row.innerHTML = `
                <td>${rankDisplay}</td>
                <td>${user.username}</td>
                <td>${user.averageScore.toFixed(2)}%</td>
            `;
            
            if (index < 3) {
                row.classList.add(`medal-${index + 1}`);
            }
            
            tbody.appendChild(row);
        });
    }

    // Replace the existing showLeaderboard function with this one
    function showLeaderboard() {
        document.getElementById('leaderboardModal').style.display = 'block';
        document.body.style.overflow = 'hidden';
        fetchOverallLeaderboard();
    }
  </script>
</body>
</html>